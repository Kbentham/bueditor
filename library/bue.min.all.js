// $Id$

//Merged and minified: bue.popup.js, bue.html.js, bue.preview.js, bue.imce.js, bue.misc.js, bue.accessibility.js, bue.autocomplete.js, bue.ctrl.js, bue.find.js, bue.history.js, bue.li.js, bue.tab.js
(function(E,$){BUE.popups=BUE.popups||{};BUE.popHtml='<table class="bue-popup" style="display: none;"><tbody class="bue-zero"><tr class="bue-zero"><td class="bue-zero"><div class="bue-popup-head clear-block"><div class="bue-popup-title"></div><div class="bue-popup-close">x</div></div><div class="bue-popup-body clear-block"><div class="bue-popup-content"></div></div></td></tr></tbody></table>';BUE.openPopup=function(id,title,content,effect){return BUE.createPopup(id).open(title,content,effect);};BUE.createPopup=function(id,title,content){if(BUE.popups[id]){return BUE.popups[id];}
var P=BUE.popups[id]=$html(BUE.popHtml).appendTo('body').attr('id',id).find('.bue-popup-title').html(title||'').end().find('.bue-popup-content').html(content||'').end().get(0);P.open=function(title,content,effect){var E=P.bue=BUE.active,B=E.buttons[E.bindex],pos=$(B).offset();$(P).css({left:pos.left-20,top:pos.top+10});if(typeof title!='undefined'&&title!=null){$('.bue-popup-title',P).html(title);}
if(typeof content!='undefined'&&content!=null){$('.bue-popup-content',P).html(content);}
$(P)[effect||'show']();B.pops=true;P.focus&&P.focus();return P;};P.close=function(effect){return $(P)[effect||'hide']()[0]};$('.bue-popup-close',P).click(function(){P.close()});$('.bue-popup-head',P).mousedown(function(e){var pos={X:parseInt($(P).css('left'))-e.pageX,Y:parseInt($(P).css('top'))-e.pageY};var drag=function(e){$(P).css({left:pos.X+e.pageX,top:pos.Y+e.pageY});return false;};var undrag=function(e){$(document).unbind('mousemove',drag).unbind('mouseup',undrag)};$(document).mousemove(drag).mouseup(undrag);});return P;};BUE.postprocess.unshift(function(Ed,$){if(Ed.index)return;var D=E.dialog=BUE.dialog=BUE.createPopup('bue-dialog');var foc=function(){this.blur()};var Do=D.open,Dc=D.close;D.open=function(title,content,effect){D.esp&&D.close();var E=BUE.active;E.buttonsDisabled(true);$(E.buttons[E.bindex]).addClass('stay-clicked');D.esp=E.posSelection();$(E.textArea).focus(foc);return Do(title,content,effect);};D.close=function(effect){if(!D.esp)return D;var E=D.bue;$(E.textArea).unbind('focus',foc);E.buttonsDisabled(false);$(E.buttons[E.bindex]).removeClass('stay-clicked');E==BUE.active&&E.makeSelection(D.esp.start,D.esp.end).focus();D.esp=null;return Dc(effect);};var Q=E.quickPop=BUE.quickPop=BUE.createPopup('bue-quick-pop');var Qo=Q.open,Qc=Q.close;Q.open=function(content,effect){$(document).mouseup(Q.close);return Qo(null,content,effect);};Q.close=function(){$(document).unbind('mouseup',Q.close);return Qc();};$('.bue-popup-head',Q).hide();});var $html=BUE.$html;})(BUE.instance.prototype,jQuery);(function($){BUE.html=function(tag,ihtml,attr){var A=attr||{},I=ihtml||'';var H='<'+tag;for(var i in A){H+=A[i]==null?'':' '+i+'="'+A[i]+'"';}
H+=Nc(tag)?(' />'+I):('>'+I+'</'+tag+'>');return tag?H:I;};BUE.input=function(t,n,v,a){return Html('input','',$.extend({'type':t,'name':n,'value':v||null},a));};BUE.selectbox=function(n,v,opt,attr){var opt=opt||{},H='';for(var i in opt){H+=Html('option',opt[i],{'value':i,'selected':i==v?'selected':null});}
return Html('select',H,$.extend({},attr,{'name':n}));};BUE.table=function(rows,attr){for(var R,H='',i=0;R=rows[i];i++){H+=typeof R['data']=='undefined'?BUE.trow(R):BUE.trow(R['data'],R['attr']);}
return Html('table',H,attr);};BUE.trow=function(cells,attr){for(var C,H='',i=0;C=cells[i];i++){H+=typeof C['data']=='undefined'?Html('td',C):Html('td',C['data'],C['attr']);}
return Html('tr',H,attr);};BUE.regesc=function(s){return s.replace(/([\\\^\$\*\+\?\.\(\)\[\]\{\}\|\:])/g,'\\$1');};BUE.nctag=function(s){return!s||s.search(/^(img|input|hr|br|embed)$/)>-1;};BUE.parseHtml=function(s,tag){var r=new RegExp('^<('+(tag||'[a-z][a-z0-9]*')+')([^>]*)>($|((?:.|[\r\n])*)</\\1>$)');if(!(match=s.match(r))||(!match[3]&&!Nc(match[1]))){return null;}
var tag=match[1],arr=[],attr={},match;if((arr=match[2].split('"')).length>1){for(var i=0;typeof(arr[i+1])!='undefined';i+=2){attr[arr[i].replace(/\s|\=/g,'')]=arr[i+1];}}
return{tag:tag,attributes:attr,html:match[4]};};var Html=BUE.html;var Nc=BUE.nctag;})(jQuery);eDefHTML=BUE.html;eDefInput=BUE.input;eDefSelectBox=BUE.selectbox;eDefTable=BUE.table;eDefRow=BUE.trow;eDefNoEnd=BUE.nctag;eDefRegEsc=BUE.regesc;eDefParseTag=BUE.parseHtml;eDefInputText=function(n,v,s){return BUE.input('text',n,v,{'size':s||null})};eDefInputSubmit=function(n,v){return BUE.input('submit',n,v)};(function(E,$){E.prv=function(safecheck){var E=this;if(E.prvOn){return E.prvHide();}
var safecheck=typeof safecheck=='undefined'?true:safecheck;var content=E.getContent();if(safecheck&&!(E.safeToPreview=E.safeToPreview||content.indexOf('<')==-1)){content='<div class="warning">'+Drupal.t('The preview is disabled due to previously inserted HTML code in the content. This aims to protect you from any potentially harmful code inserted by other editors or users. If you own the content, just preview an empty text to re-enable the preview.')+'</div>';}
return E.prvShow(BUE.autop(content));};E.prvShow=function(html,wrap){var E=this;var $T=$(E.textArea);var $P=E.preview?$(E.preview):$(E.preview=document.createElement('div')).addClass('preview').css({'display':'none','overflow':'auto'}).insertBefore($T);if(typeof wrap=='undefined'||wrap){html='<div class="'+(E.textArea.name=='comment'?'comment':'node')+'"><div class="content">'+html+'</div></div>';}
if(E.prvOn){$P.html(html);return E;}
$P.show().height($T.height()).width($T.width()).html(html);$T.height(1);E.buttonsDisabled(true,E.bindex);$(E.buttons[E.bindex]).addClass('stay-clicked');E.prvOn=true;return E;};E.prvHide=function(){var E=this;if(E.prvOn){var $P=$(E.preview);$(E.textArea).height($P.height());$P.hide();$(E.buttons[E.bindex]).removeClass('stay-clicked');E.buttonsDisabled(false);E.prvOn=false;}
return E;};E.prvAjax=function(){var E=this,$xM;if(E.prvOn){return E.prvHide();}
if(!($xM=$.ajaxMarkup)){return E.prvShow(Drupal.t('Preview requires <a href="http://drupal.org/project/ajax_markup">Ajax markup</a> module with proper permissions set.'));}
E.prvShow(Drupal.t('Loading...'));$xM(E.getContent(),$xM.getFormat(E.textArea),function(output,status,request){E.prvOn&&E.prvShow(status?output:output.replace(/\n/g,'<br />'));});return E;};BUE.autop=function(s){if(s==''||s.search(/\n|\r/)==-1){return s;}
var X=function(x,a,b){return x.replace(new RegExp(a,'g'),b)};var R=function(a,b){return s=X(s,a,b)};var blocks='(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])';s+='\n';R('<br />\\s*<br />','\n\n');R('(<'+blocks+'[^>]*>)','\n$1');R('(</'+blocks+'>)','$1\n\n');R('\r\n|\r','\n');R('\n\n+','\n\n');R('\n?((.|\n)+?)\n\\s*\n','<p>$1</p>\n');R('\n?((.|\n)+?)$','<p>$1</p>\n');R('<p>\\s*?</p>','');R('<p>(<div[^>]*>\\s*)','$1<p>');R('<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)','<p>$1</p>$2');R('<p>\\s*(</?'+blocks+'[^>]*>)\\s*</p>','$1');R('<p>(<li.+?)</p>','$1');R('<p><blockquote([^>]*)>','<blockquote$1><p>');R('</blockquote></p>','</p></blockquote>');R('<p>\\s*(</?'+blocks+'[^>]*>)','$1');R('(</?'+blocks+'[^>]*>)\\s*</p>','$1');R('<(script|style)(.|\n)*?</\\1>',function(m0){return X(m0,'\n','<PNL>')});R('(<br />)?\\s*\n','<br />\n');R('<PNL>','\n');R('(</?'+blocks+'[^>]*>)\\s*<br />','$1');R('<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)','$1');if(s.indexOf('<pre')!=-1){R('(<pre(.|\n)*?>)((.|\n)*?)</pre>',function(m0,m1,m2,m3){return X(m1,'\\\\([\'\"\\\\])','$1')+X(X(X(m3,'<p>','\n'),'</p>|<br />',''),'\\\\([\'\"\\\\])','$1')+'</pre>';});}
return R('\n</p>$','</p>');};})(BUE.instance.prototype,jQuery);eDefAutoP=BUE.autop;eDefPreview=function(){BUE.active.prv()};eDefPreviewShow=function(E,s,w){E.prvShow(s,w)};eDefPreviewHide=function(E){E.prvHide()};eDefAjaxPreview=function(){BUE.active.prvAjax()};(function(E,$){var I=E.imce=BUE.imce={};$(function(){I.url=Drupal.settings.BUE.imceURL||''});I.button=function(fname,text){return I.url?'<input type="button" id="bue-imce-button" name="bib" value="'+(text||Drupal.t('Browse'))+'" onclick="BUE.imce.open(this.form.elements[\''+fname+'\'])">':'';};I.prepare=function(opt){I.ready=I.sendto=function(){};if(!opt)return;if(opt.form){I.target=opt;I.ready=I.highlightTarget;I.sendto=I.fillTarget;}
else{$.isFunction(opt.ready)&&(I.ready=opt.ready);$.isFunction(opt.sendto)&&(I.sendto=opt.sendto);}};I.open=function(opt){I.prepare(opt);if(!I.pop){var url=I.url+(I.url.indexOf('?')<0?'?':'&')+'app=bue|imceload@bueImceLoad';I.pop=BUE.openPopup('bue-imce-pop',Drupal.t('File Browser'),'<iframe src="'+url+'"></iframe>');}
else{I.pop.open();I.ready(I.win,I.pop);}
var $p=$(I.pop),$w=$(window),o=$.browser.opera;var h=(o?$w[0].innerHeight:$w.height())-$p.height(),w=$w.width()-$p.width();$p.css({'top':$w.scrollTop()+Math.max(0,h/2),'left':Math.max(0,w/2)});};I.finish=function(file,win){I.sendto(file,win,I.pop);};I.fillTarget=function(file,win,pop){var target=I.target,el=target.form.elements,val={'alt':file.name,'width':file.width,'height':file.height};target.value=file.url;for(var i in val){if(el['attr_'+i])el['attr_'+i].value=val[i];}
pop.close();target.focus();};I.highlightTarget=function(win,pop){I.win.imce.highlight(I.target.value.substr(I.target.value.lastIndexOf('/')+1));};window.bueImceLoad=function(win){(I.win=win).imce.setSendTo(Drupal.t('Send to editor'),I.finish);I.ready(win,I.pop);};})(BUE.instance.prototype,jQuery);eDefBrowseButton=function(l,f,t){return BUE.imce.button(f,t)};(function(E,$){E.wrapLines=function(a1,b1,b2,a2){var E=this,str=E.getSelection().replace(/\r\n|\r/g,'\n'),Esc=BUE.regesc;if(!str){return E.tagSelection(a1+b1,b2+a2);}
var M,R=new RegExp('^'+Esc(a1+b1)+'((.|\n)*)'+Esc(b2+a2)+'$');if(M=str.match(R)){R=new RegExp(Esc(b2)+'\n'+Esc(b1),'g');return E.replaceSelection(M[1].replace(R,'\n'));}
return E.replaceSelection(a1+b1+str.replace(/\n/g,b2+'\n'+b1)+b2+a2);};E.toggleTag=function(tag,attributes,cursor){var E=this,S=E.getSelection(),O=BUE.parseHtml(S,tag);if(O){return E.replaceSelection(O.html,cursor);}
E.replaceSelection(BUE.html(tag,S,attributes),cursor);if(!S&&!BUE.nctag(tag)){var pos=E.posSelection().end-tag.length-3;E.makeSelection(pos,pos);}
return E;};E.help=function(effect){var E=this;if(!E.helpHTML){var akey=E.ctrlKeys?'Ctrl':($.browser.mozilla?'Shift + Alt':($.browser.msie?'Alt':''));for(var B,rows=[],i=0;B=E.buttons[i];i++){rows[i]=[BUE.input(B.type,null,B.value||null,{'class':B.className,'src':B.src||null}),B.title];if(B.accessKey&&akey){rows[i][1]+=' ('+akey+' + '+B.accessKey+')';}}
E.helpHTML=BUE.table(rows,{'id':'bue-help'});}
E.quickPop.open(E.helpHTML,effect);return E;};E.tagChooser=function(tags,opt){var E=this,opt=$.extend({wrapEach:'li',wrapAll:'ul',applyTag:true,effect:'slideDown'},opt);var wa=BUE.html(opt.wrapAll||'div','',{'class':'tag-chooser'}),$wa=$html(wa);var we=BUE.html(opt.wrapEach,'',{'class':'choice'});var lnk=BUE.html('a','',{href:'#','class':'choice-link'});for(var i in tags){var data={nc:BUE.nctag(tags[i][0]),html:BUE.html(tags[i][0],tags[i][1],tags[i][2])},$lnk=$html(lnk);$lnk.html(opt.applyTag?data.html:tags[i][1]).bind('click',data,function(e){var h=e.data.html,p1=h.substr(0,h.indexOf('>')+1);e.data.nc?E.replaceSelection(p1).focus():E.tagSelection(p1,h.substr(h.lastIndexOf('<'))).focus();return false;}).appendTo($wa)[we?'wrap':'end'](we);}
E.quickPop.open($wa,opt.effect);return E;};E.tagDialog=function(tag,fields,opt){var E=this,S=E.getSelection(),O=BUE.parseHtml(S,tag)||{'attributes':{}};for(var field,rows=[],i=0,n=0;field=fields[i];i++,n++){field=fproc(field,O,S);rows[n]=[field.title,fhtml(field)];while(field.getnext&&(field=fields[++i])){rows[n][1]+=fhtml(fproc(field,O,S));}}
var opt=$.extend({title:Drupal.t('Tag editor - @tag',{'@tag':tag.toUpperCase()}),stitle:Drupal.t('OK'),validate:false,submit:function(a,b){return E.tgdSubmit(a,b)},effect:'show'},opt);var table=BUE.table(rows,{'class':'bue-tgd-table'})
var sbm=BUE.html('div',BUE.input('submit','bue_tgd_submit',opt.stitle));var $form=$html(BUE.html('form',table+sbm,{name:'bue_tgd_form',id:'bue-tgd-form'}));E.dialog.open(opt.title,$form,opt.effect);$form.submit(function(){return fsubmit(tag,this,E,opt)})[0].elements[0].focus();return E;};E.tgdSubmit=function(tag,form){var E=this,O=BUE.parseHtml(E.getSelection(),tag)||{'attributes':{}};for(var name,el,i=0;el=form.elements[i];i++){if(el.name.substr(0,5)=='attr_'){name=el.name.substr(5);if(name=='html')O.html=el.value;else O.attributes[name]=el.value.replace(/\x22/g,'&quot;').replace(/>/g,'&gt;').replace(/</g,'&lt;')||null;}}
if(typeof O.html=='string'||BUE.nctag(tag)){E.replaceSelection(BUE.html(tag,O.html,O.attributes));}
else{var h=BUE.html(tag,'',O.attributes);E.tagSelection(h.substr(0,h.length-tag.length-3),'</'+tag+'>');}
return E;};var $html=BUE.$html;var fhtml=function(f){var h=f.prefix||'';switch(f.type){case'select':h+=BUE.selectbox(f.fname,f.value,f.options||{},f.attributes);break;case'textarea':h+=BUE.html('textarea','\n'+f.value,f.attributes);break;default:h+=BUE.input('text',f.fname,f.value,f.attributes);break;}
return h+(f.suffix||'');};var fproc=function(f,O,S){f=typeof(f)=='string'?{'name':f}:f;if(f.name=='html'){f.value=typeof O.html=='string'?O.html:(S||f.value||'');}
f.value=Drupal.checkPlain(typeof O.attributes[f.name]=='string'?O.attributes[f.name]:(f.value||''));f.title=typeof f.title=='string'?f.title:f.name.substr(0,1).toUpperCase()+f.name.substr(1);f.fname='attr_'+f.name;f.attributes=$.extend({name:f.fname,id:f.fname},f.attributes);f.attributes['class']=f.required?(f.attributes['class']||'')+' required':(f.attributes['class']||null);f.type=f.value.indexOf('\n')>-1?'textarea':(f.type||'text');return f;};var fsubmit=function(tag,form,E,opt){for(var el,i=0;el=form.elements[i];i++)if($(el).is('.required')&&!el.value){$(el).fadeOut('fast',function(){$(this).fadeIn('fast').focus()});return false;}
var V=opt.validate;if(V&&$.isFunction(V)){try{if(!V(tag,form))return false}catch(e){alert(e.name+': '+e.message)};}
E.dialog.close();var S=opt.submit;S=typeof S=='string'?window[S]:S;if(S&&$.isFunction(S)){try{S(tag,form)}catch(e){alert(e.name+': '+e.message)};}
return false;};})(BUE.instance.prototype,jQuery);eDefSelProcessLines=eDefTagLines=function(a,b,c,d){BUE.active.wrapLines(a,b,c,d)};eDefTagger=function(a,b,c){BUE.active.toggleTag(a,b,c)};eDefHelp=function(fx){BUE.active.help(fx)};eDefTagDialog=function(a,b,c,d,e,f){BUE.active.tagDialog(a,b,{title:c,stitle:d,submit:e,effect:f})};eDefTagInsert=function(a,b){BUE.active.tgdSubmit(a,b)};eDefTagChooser=function(a,b,c,d,e){BUE.active.tagChooser(a,{applyTag:b,wrapEach:c,wrapAll:d,effect:e})};BUE.postprocess.push(function(E,$){if(E.index)return;var Q=E.quickPop,Qo=Q.open,D=E.dialog;Q.open=function(content,effect){Qo(content,effect);$(Q).find('a:first').focus();return Q;};$(Q).attr('tabindex',0).keydown(function(e){switch(e.keyCode){case 13:case 27:setTimeout(function(){Q.close().bue.focus()});break;case 38:case 40:var $a=$('a',E.quickPop),i=$a.index(document.activeElement);$a.eq(i+e.keyCode-39).focus();return false;}});$(D).attr('tabindex',0).keydown(function(e){e.keyCode==27&&D.close();});});BUE.postprocess.push(function(E,$){E.AC={'<!--':'-->','<?php':'?>'};if(!E.index)BUE.postprocess.push(function(E,$){$.each(E.AC,function(a,b){var len=a.length;if(len>1){var chr=a.charAt(len-1);if(typeof E.AC[chr]!='object'){E.AC[chr]={lookback:{},ins:E.AC[chr]||false};}
E.AC[chr].lookback[a.substr(0,len-1)]=b;delete E.AC[a];}});});$(E.textArea).keypress(function(e){var code=typeof e.charCode=='undefined'?e.keyCode:e.charCode;if($.browser.opera&&(code+'').search(/^(39|40)$/)!=-1)return;var ac,chr=String.fromCharCode(code);if(!(ac=E.AC[chr]))return;if(!ac.lookback)return E.replaceSelection(ac,'start');var pos=E.posSelection(),content=E.getContent();for(var lb in ac.lookback){if(content.substring(pos.start-lb.length,pos.start)==lb){return E.replaceSelection(ac.lookback[lb],'start');}}
if(ac.ins){return E.replaceSelection(ac.ins,'start');}});});BUE.postprocess.push(function(E,$){E.ctrlKeys={};$.each(E.buttons,function(i,B){if(k=E.tpl.buttons[B.bid][3]){E.ctrlKeys[k.toUpperCase().charCodeAt(0)]=B;}});$(E.textArea).keydown(function(e){if(e.ctrlKey&&!e.shiftKey&&!e.originalEvent.altKey&&E.ctrlKeys[e.keyCode]){E.ctrlKeys[e.keyCode].click();return false;}});});(function(E,$){E.find=function(str,mc,re){var E=this,from=E.posSelection().end,content=E.getContent();if(from==content.length)from=0;var content=content.substr(from);var regx=new RegExp(re?str:BUE.regesc(str),mc?'':'i');var index=content.search(regx);if(index==-1){if(from==0){alert(Drupal.t('No matching phrase found!'));}
else if(CM()){E.makeSelection(0,0);E.find(str,mc,re);}}
else{var strlen=re?content.match(regx)[0].length:str.length;index+=from;E.makeSelection(index,index+strlen).scrollTo(index);}
return E;};E.replace=function(str1,str2,mc,re){var E=this,s=E.find(str1,mc,re).getSelection();var rgx=new RegExp('^'+(re?str1:BUE.regesc(str1))+'$',mc?'':'i');if(s&&s.search(rgx)==0&&confirm(Drupal.t('Replace this occurance of "!text"?',{'!text':s}))){str2=re?s.replace(new RegExp(str1,'g'+(mc?'':'i')),str2):str2;E.replaceSelection(str2);}
return E;};E.replaceAll=function(str1,str2,mc,re){var E=this,P=E.posSelection(),C=E.getContent(),n=0;var R=new RegExp(re?str1:BUE.regesc(str1),'g'+(mc?'':'i'));var F=re?(function(s){n++;return s.replace(R,str2)}):(function(){n++;return str2;});var start=P.start==0||CM()?0:P.start;E.setContent(C.substr(0,start)+C.substr(start).replace(R,F));alert(Drupal.t('Total replacements: !count',{'!count':n}));return E;};E.scrollTo=function(index){var E=this,T=E.textArea,h=$(T).height();var sT=BUE.scrlT=BUE.scrlT||$(document.createElement('textarea')).css({width:$(T).width(),height:1,visibility:'hidden'}).appendTo(document.body)[0];sT.value=T.value.substr(0,index);T.scrollTop=sT.scrollHeight>h?sT.scrollHeight-Math.ceil(h/2):0;return E;};E.frForm=function(op,mc,re){var el=FRF().elements,rp=op=='replace';BUE.frPop.open(rp?Drupal.t('Find & Replace'):Drupal.t('Search'));$(el.mc.parentNode)[mc?'show':'hide']();$(el.re.parentNode)[re?'show':'hide']();$([el.rp.parentNode,el.rpb,el.rab])[rp?'show':'hide']();$(el.fnb)[rp?'hide':'show']();el.fn.focus();return this;};E.frSubmit=function(B){var E=this,el=B.form.elements,fn=BUE.text(el.fn.value);if(!fn){el.fn.focus();return E;}
var op=B.name,rp=BUE.text(el.rp.value);var mc=$(el.mc.parentNode).is(':visible')&&el.mc.checked;var re=$(el.re.parentNode).is(':visible')&&el.re.checked;switch(op){case'fnb':E.find(fn,mc,re);break;case'rpb':E.replace(fn,rp,mc,re);break;case'rab':E.replaceAll(fn,rp,mc,re);break;}
return E.focus();};var H=BUE.html,I=BUE.input;var CM=function(){return confirm(Drupal.t('End of textarea reached. Continue search at the beginning of textarea?'));};var K=function(name,value){if(typeof(value)=='undefined'){return unescape((document.cookie.match(new RegExp('(^|;) *'+name+'=([^;]*)(;|$)'))||['','',''])[2]);}
document.cookie=name+'='+escape(value)+'; expires='+(new Date(new Date()*1+30*86400000)).toGMTString()+'; path=/';};var FRF=function(){if(BUE.frForm)return BUE.frForm;var Dv=function(s){return H('div',s,{style:'margin-bottom: 4px'})};var Ta=function(n){return H('span',H('textarea',K('bfr_'+n),{name:n,cols:36,rows:1,'class':'resizable'}))};var Cb=function(n,v){return H('span',I('checkbox',n,'',{checked:K('bfr_'+n)||null})+v)};var Bt=function(n,v){return I('button',n,v,{onclick:'BUE.active.frSubmit(this)'})};var F=Dv(Ta('fn'))+Dv(Ta('rp'));F+=Dv(Cb('mc',Drupal.t('Match case'))+' '+Cb('re',Drupal.t('Regular expressions')));F+=Dv(Bt('fnb',Drupal.t('Find next'))+' '+Bt('rpb',Drupal.t('Replace'))+' '+Bt('rab',Drupal.t('Replace all')));BUE.frPop=BUE.createPopup('bue-fr-pop',null,F=BUE.frForm=$(H('form',F))[0]);Drupal.behaviors.textarea(F);$('div.grippie',F).height(4);$(window).unload(function(){if(!BUE.frForm)return;var el=BUE.frForm.elements;K('bfr_fn',el.fn.value);K('bfr_rp',el.rp.value);K('bfr_mc',el.mc.checked?'checked':'');K('bfr_re',el.re.checked?'checked':'');});return F;};})(BUE.instance.prototype,jQuery);(function(E,$){BUE.history=function(E){var H=this;H.bue=E;H.max=50;H.keys={'13':1,'32':1};H.period=2000;H.states=[];H.current=-1;H.writable=true;$(E.textArea).one('focus',function(){H.save()}).keyup(function(e){H.writable&&H.keys[e.keyCode]&&H.save();});E.historySetContent=E.setContent;E.setContent=function(content){H.save();return E.historySetContent(content);};};var H=BUE.history.prototype;H.allow=function(){this.writable=true};H.disallow=function(){this.writable=false};H.save=function(bypass){var H=this,E=H.bue;if(!bypass&&!H.writable){return;}
H.disallow();setTimeout(function(){H.allow()},H.period);while(H.states[H.current+1]){H.states.pop();}
var val=E.getContent(),len=H.states.length;if(len&&val==H.states[len-1].value){return;}
if(len==H.max){H.states.shift();len--;}
H.states[(H.current=len)]={value:val,cursor:E.posSelection()};};H.go=function(i){var H=this,E=H.bue;i<0&&H.current==H.states.length-1&&H.save(true);var state,index=H.current+i;if(state=H.states[index]){E.textArea.value=state.value;E.makeSelection(state.cursor.start,state.cursor.end);H.current=index;}};E.undo=function(){this.history.go(-1)};E.redo=function(){this.history.go(1)};BUE.postprocess.push(function(E,$){E.history=new BUE.history(E);});})(BUE.instance.prototype,jQuery);BUE.postprocess.push(function(E,$){$(E.textArea).keyup(function(e){if(!e.ctrlKey&&!e.shiftKey&&!e.originalEvent.altKey&&e.keyCode==13){var text=E.getContent().substr(0,E.posSelection().start);if(text.search(/<\/li>\s*$/)!=-1){E.tagSelection('<li>','</li>');}}});});BUE.postprocess.push(function(E,$){E.tabs={str:'  ',on:true,autoin:true,blocks:true};$(E.textArea).keydown(function(e){if(e.keyCode==9){if(e.ctrlKey&&e.originalEvent.altKey){E.tabs.on=!E.tabs.on;return false;}
if(E.tabs.on&&!e.ctrlKey&&!e.originalEvent.altKey){var tab=E.tabs.str;if(e.shiftKey){var P=E.posSelection(),start=Math.max(0,P.start-tab.length);if(E.getContent().substring(start,P.start)==tab){E.makeSelection(start,P.end);}
E.replaceSelection(E.getSelection().replace(new RegExp('^'+tab),''));E.replaceSelection(E.tabs.blocks?E.getSelection().replace(new RegExp('\n'+tab,'g'),'\n'):'');}
else{if(E.tabs.blocks){E.replaceSelection(E.getSelection().replace(/\n/g,'\n'+tab)).tagSelection(tab,'');}
else{E.replaceSelection(tab,'end');}}
if($.browser.opera){$(E.textArea).one('blur',function(){this.focus()});}
return false;}}
else if(E.tabs.autoin&&!e.ctrlKey&&!e.shiftKey&&!e.originalEvent.altKey&&e.keyCode==13){var m,text=E.getContent().substr(0,E.posSelection().start);if(m=text.substr(text.lastIndexOf('\n')+1).match(/^(\s+)/)){E.replaceSelection('\n'+m[1],'end');if($.browser.opera){setTimeout(function(){var pos=E.posSelection();E.makeSelection(pos.start-1,pos.end).replaceSelection('','end');},0);}
return false;}}});});